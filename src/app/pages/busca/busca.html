<div class="busca-container">
  <!-- Header -->
  <div class="busca-header">
    <h2 class="busca-title">Busca de Dados P√∫blicos</h2>
    <p class="busca-subtitle">Pesquise informa√ß√µes sobre CEP, CNPJ, munic√≠pios, despesas e contratos p√∫blicos</p>
  </div>

  <!-- Navega√ß√£o por Abas (Manual) -->
  <div class="tabs-navigation">
    <button 
      class="tab-button"
      [class.tab-active]="abaAtiva === 'cep'"
      (click)="selecionarAba('cep')">
      üìç CEP
    </button>
    <button 
      class="tab-button"
      [class.tab-active]="abaAtiva === 'cnpj'"
      (click)="selecionarAba('cnpj')">
      üè¢ CNPJ
    </button>
    <button 
      class="tab-button"
      [class.tab-active]="abaAtiva === 'municipio'"
      (click)="selecionarAba('municipio')">
      üèôÔ∏è Munic√≠pios
    </button>
    <button 
      class="tab-button"
      [class.tab-active]="abaAtiva === 'despesas'"
      (click)="selecionarAba('despesas')">
      üèõÔ∏è √ìrg√£os
    </button>
    <button 
      class="tab-button"
      [class.tab-active]="abaAtiva === 'contratos'"
      (click)="selecionarAba('contratos')">
      üìù Licita√ß√µes
    </button>
  </div>

  <!-- Conte√∫do das Abas -->
  <div class="tabs-content">
    
    <!-- ABA CEP -->
    <div class="tab-panel" *ngIf="abaAtiva === 'cep'">
      <div class="search-section">
        <h3 class="panel-title">Consultar CEP</h3>
        <p class="panel-description">Digite o CEP para consultar endere√ßo completo</p>
        
        <div class="info-box-small">
          <span class="info-icon-small">‚ÑπÔ∏è</span>
          <span class="info-text-small">Insira apenas n√∫meros, sem tra√ßos ou pontos (ex: 01310100)</span>
        </div>
        
        <div class="search-form">
          <input 
            type="text" 
            class="search-input"
            [(ngModel)]="cepBusca"
            placeholder="Digite o CEP (ex: 01310100)"
            maxlength="8"
            (keyup.enter)="buscarCep()">
          <button class="search-button" (click)="buscarCep()" [disabled]="loading">
            {{ loading ? 'Buscando...' : 'Buscar' }}
          </button>
        </div>

        <div class="alert alert-error" *ngIf="erro">{{ erro }}</div>

        <div class="result-card" *ngIf="resultadoCep">
          <h4 class="result-title">üìç Endere√ßo Encontrado</h4>
          <div class="result-grid">
            <div class="result-item">
              <strong>CEP:</strong>
              <span>{{ formatarCep(resultadoCep.cep) }}</span>
            </div>
            <div class="result-item">
              <strong>Logradouro:</strong>
              <span>{{ resultadoCep.street }}</span>
            </div>
            <div class="result-item">
              <strong>Bairro:</strong>
              <span>{{ resultadoCep.neighborhood }}</span>
            </div>
            <div class="result-item">
              <strong>Cidade:</strong>
              <span>{{ resultadoCep.city }} - {{ resultadoCep.state }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ABA CNPJ -->
    <div class="tab-panel" *ngIf="abaAtiva === 'cnpj'">
      <div class="search-section">
        <h3 class="panel-title">Consultar CNPJ</h3>
        <p class="panel-description">Digite o CNPJ para consultar dados da empresa</p>
        
        <div class="info-box-small">
          <span class="info-icon-small">‚ÑπÔ∏è</span>
          <span class="info-text-small">Insira apenas n√∫meros, sem pontos, barras ou tra√ßos (ex: 00000000000191)</span>
        </div>
        
        <div class="search-form">
          <input 
            type="text" 
            class="search-input"
            [(ngModel)]="cnpjBusca"
            placeholder="Digite o CNPJ (ex: 00000000000191)"
            maxlength="14"
            (keyup.enter)="buscarCnpj()">
          <button class="search-button" (click)="buscarCnpj()" [disabled]="loading">
            {{ loading ? 'Buscando...' : 'Buscar' }}
          </button>
        </div>

        <div class="alert alert-error" *ngIf="erro">{{ erro }}</div>

        <div class="result-card" *ngIf="resultadoCnpj">
          <h4 class="result-title">üè¢ Empresa Encontrada</h4>
          <div class="result-grid">
            <div class="result-item">
              <strong>CNPJ:</strong>
              <span>{{ formatarCnpj(resultadoCnpj.cnpj) }}</span>
            </div>
            <div class="result-item">
              <strong>Raz√£o Social:</strong>
              <span>{{ resultadoCnpj.razao_social }}</span>
            </div>
            <div class="result-item">
              <strong>Nome Fantasia:</strong>
              <span>{{ resultadoCnpj.nome_fantasia || 'N√£o informado' }}</span>
            </div>
            <div class="result-item">
              <strong>Situa√ß√£o:</strong>
              <span>{{ resultadoCnpj.descricao_situacao_cadastral }}</span>
            </div>
            <div class="result-item full-width">
              <strong>Endere√ßo:</strong>
              <span>{{ resultadoCnpj.logradouro }}, {{ resultadoCnpj.numero }} - {{ resultadoCnpj.bairro }}, {{ resultadoCnpj.municipio }} - {{ resultadoCnpj.uf }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ABA MUNIC√çPIOS -->
    <div class="tab-panel" *ngIf="abaAtiva === 'municipio'">
      <div class="search-section">
        <h3 class="panel-title">Consultar Munic√≠pios</h3>
        <p class="panel-description">Selecione um estado para listar todos os munic√≠pios</p>
        
        <div class="search-form">
          <select class="search-select" [(ngModel)]="estadoSelecionado" (change)="buscarMunicipios()">
            <option value="">Selecione um estado</option>
            <option *ngFor="let estado of listaEstados" [value]="estado.sigla">
              {{ estado.nome }} ({{ estado.sigla }})
            </option>
          </select>
        </div>

        <div class="alert alert-error" *ngIf="erro">{{ erro }}</div>

        <div class="municipios-list" *ngIf="listaMunicipios.length > 0">
          <h4 class="result-title">üèôÔ∏è Munic√≠pios de {{ estadoSelecionado }} ({{ listaMunicipios.length }})</h4>
          <div class="municipios-grid">
            <div class="municipio-item" *ngFor="let municipio of listaMunicipios">
              {{ municipio.nome }}
            </div>
          </div>
        </div>

        <div class="loading-container" *ngIf="loading">
          <div class="spinner"></div>
          <p>Carregando munic√≠pios...</p>
        </div>
      </div>
    </div>

    <!-- ABA DESPESAS -->
    <div class="tab-panel" *ngIf="abaAtiva === 'despesas'">
      <div class="search-section">
        <h3 class="panel-title">√ìrg√£os P√∫blicos Federais</h3>
        <p class="panel-description">Consulte √≥rg√£os do SIAFI - Sistema Integrado de Administra√ß√£o Financeira (Portal da Transpar√™ncia)</p>
        
        <!-- Explica√ß√£o sobre CORS -->
        <div class="info-box">
          <div class="info-icon">‚ÑπÔ∏è</div>
          <div class="info-content">
            <h4 class="info-title">Por que n√£o consigo ver os dados aqui?</h4>
            <p class="info-text">
              A <strong>API do Portal da Transpar√™ncia</strong> n√£o permite acesso direto de navegadores web devido a uma pol√≠tica de seguran√ßa chamada <strong>CORS (Cross-Origin Resource Sharing)</strong>.
            </p>
            <p class="info-text">
              Isso acontece porque o servidor da API n√£o envia o header <code>Access-Control-Allow-Origin</code>, que √© necess√°rio para que navegadores permitam requisi√ß√µes de outros dom√≠nios.
            </p>
            <h5 class="info-subtitle">üìö O que √© CORS?</h5>
            <p class="info-text">
              CORS √© uma medida de seguran√ßa dos navegadores que impede que sites maliciosos fa√ßam requisi√ß√µes n√£o autorizadas para outros servidores em nome do usu√°rio. 
              Apenas o servidor da API pode permitir esse acesso, e o Portal da Transpar√™ncia optou por restringir chamadas diretas via JavaScript.
            </p>
            <h5 class="info-subtitle">‚úÖ Como acessar os dados?</h5>
            <ul class="info-list">
              <li><strong>Op√ß√£o 1:</strong> Acessar diretamente o site oficial do Portal da Transpar√™ncia</li>
              <li><strong>Op√ß√£o 2:</strong> Fazer download dos dados p√∫blicos em CSV/JSON</li>
              <li><strong>Op√ß√£o 3:</strong> Usar um servidor intermedi√°rio (backend) que n√£o tenha restri√ß√µes de CORS</li>
            </ul>
          </div>
        </div>

        <!-- Bot√µes de acesso direto -->
        <div class="action-buttons">
          <button class="action-button primary" (click)="abrirPortalTransparencia('orgaos')">
            üîó Acessar √ìrg√£os no Portal da Transpar√™ncia
          </button>
          <button class="action-button secondary" (click)="abrirPortalTransparencia('downloads')">
            üì• Baixar Dados Abertos (CSV/JSON)
          </button>
        </div>
        
        <!-- Tentativa de busca (vai falhar por CORS) -->
        <div class="divider">
          <span>ou tente buscar mesmo assim</span>
        </div>

        <button class="search-button full-width" (click)="buscarDespesas()" [disabled]="loading">
          {{ loading ? 'Tentando...' : 'üîç Tentar Buscar API (n√£o funcionar√°)' }}
        </button>

        <div class="alert alert-error" *ngIf="erro">{{ erro }}</div>

        <div class="data-list" *ngIf="listaDespesas.length > 0">
          <h4 class="result-title">üèõÔ∏è √ìrg√£os SIAFI ({{ listaDespesas.length }})</h4>
          <div class="data-table">
            <div class="data-row" *ngFor="let orgao of listaDespesas">
              <div class="data-cell">
                <strong>C√≥digo:</strong> {{ orgao.codigo || orgao.codigoSIAFI || 'N/A' }}
              </div>
              <div class="data-cell">
                <strong>Nome:</strong> {{ orgao.nome || 'N√£o informado' }}
              </div>
              <div class="data-cell">
                <strong>Sigla:</strong> {{ orgao.sigla || 'N/A' }}
              </div>
              <div class="data-cell" *ngIf="orgao.orgaoSuperior || orgao.naturezaJuridica">
                <strong>√ìrg√£o Superior:</strong> {{ orgao.orgaoSuperior || orgao.naturezaJuridica || 'N/A' }}
              </div>
            </div>
          </div>
        </div>

        <div class="loading-container" *ngIf="loading">
          <div class="spinner"></div>
          <p>Carregando √≥rg√£os p√∫blicos...</p>
        </div>
      </div>
    </div>

    <!-- ABA CONTRATOS -->
    <div class="tab-panel" *ngIf="abaAtiva === 'contratos'">
      <div class="search-section">
        <h3 class="panel-title">Licita√ß√µes P√∫blicas</h3>
        <p class="panel-description">Consulte licita√ß√µes do governo federal (Portal da Transpar√™ncia)</p>
        
        <!-- Explica√ß√£o sobre CORS -->
        <div class="info-box">
          <div class="info-icon">‚ÑπÔ∏è</div>
          <div class="info-content">
            <h4 class="info-title">Por que n√£o consigo ver os dados aqui?</h4>
            <p class="info-text">
              A <strong>API do Portal da Transpar√™ncia</strong> n√£o permite acesso direto de navegadores web devido a uma pol√≠tica de seguran√ßa chamada <strong>CORS (Cross-Origin Resource Sharing)</strong>.
            </p>
            <p class="info-text">
              Isso acontece porque o servidor da API n√£o envia o header <code>Access-Control-Allow-Origin</code>, que √© necess√°rio para que navegadores permitam requisi√ß√µes de outros dom√≠nios.
            </p>
            <h5 class="info-subtitle">üìö O que √© CORS?</h5>
            <p class="info-text">
              CORS √© uma medida de seguran√ßa dos navegadores que impede que sites maliciosos fa√ßam requisi√ß√µes n√£o autorizadas para outros servidores em nome do usu√°rio. 
              Apenas o servidor da API pode permitir esse acesso, e o Portal da Transpar√™ncia optou por restringir chamadas diretas via JavaScript.
            </p>
            <h5 class="info-subtitle">‚úÖ Como acessar os dados?</h5>
            <ul class="info-list">
              <li><strong>Op√ß√£o 1:</strong> Acessar diretamente o site oficial do Portal da Transpar√™ncia</li>
              <li><strong>Op√ß√£o 2:</strong> Fazer download dos dados p√∫blicos em CSV/JSON</li>
              <li><strong>Op√ß√£o 3:</strong> Usar um servidor intermedi√°rio (backend) que n√£o tenha restri√ß√µes de CORS</li>
            </ul>
          </div>
        </div>

        <!-- Bot√µes de acesso direto -->
        <div class="action-buttons">
          <button class="action-button primary" (click)="abrirPortalTransparencia('licitacoes')">
            üîó Acessar Licita√ß√µes no Portal da Transpar√™ncia
          </button>
          <button class="action-button secondary" (click)="abrirPortalTransparencia('downloads')">
            üì• Baixar Dados Abertos (CSV/JSON)
          </button>
        </div>
        
        <!-- Tentativa de busca (vai falhar por CORS) -->
        <div class="divider">
          <span>ou tente buscar mesmo assim</span>
        </div>

        <button class="search-button full-width" (click)="buscarContratos()" [disabled]="loading">
          {{ loading ? 'Tentando...' : 'üîç Tentar Buscar API (n√£o funcionar√°)' }}
        </button>

        <div class="alert alert-error" *ngIf="erro">{{ erro }}</div>

        <div class="data-list" *ngIf="listaContratos.length > 0">
          <h4 class="result-title">ÔøΩ Licita√ß√µes Encontradas ({{ listaContratos.length }})</h4>
          <div class="data-table">
            <div class="data-row" *ngFor="let licitacao of listaContratos">
              <div class="data-cell" *ngIf="licitacao.numero || licitacao.numeroLicitacao">
                <strong>N√∫mero:</strong> {{ licitacao.numero || licitacao.numeroLicitacao || 'N/A' }}
              </div>
              <div class="data-cell">
                <strong>Objeto:</strong> {{ licitacao.objeto || licitacao.objetoLicitacao || 'N√£o informado' }}
              </div>
              <div class="data-cell" *ngIf="licitacao.modalidade || licitacao.modalidadeCompra">
                <strong>Modalidade:</strong> {{ licitacao.modalidade || licitacao.modalidadeCompra || 'N/A' }}
              </div>
              <div class="data-cell" *ngIf="licitacao.situacao || licitacao.situacaoLicitacao">
                <strong>Situa√ß√£o:</strong> {{ licitacao.situacao || licitacao.situacaoLicitacao || 'N/A' }}
              </div>
              <div class="data-cell" *ngIf="licitacao.orgao || licitacao.nomeOrgao">
                <strong>√ìrg√£o:</strong> {{ licitacao.orgao || licitacao.nomeOrgao || 'N/A' }}
              </div>
              <div class="data-cell" *ngIf="licitacao.valor || licitacao.valorLicitado">
                <strong>Valor:</strong> {{ formatarMoeda(licitacao.valor || licitacao.valorLicitado || 0) }}
              </div>
            </div>
          </div>
        </div>

        <div class="loading-container" *ngIf="loading">
          <div class="spinner"></div>
          <p>Carregando licita√ß√µes...</p>
        </div>
      </div>
    </div>

  </div>
</div>
