<div class="analise-container">
  <!-- Header -->
  <div class="analise-header">
    <h2 class="analise-title">An√°lise de Dados P√∫blicos</h2>
    <p class="analise-subtitle">Visualize e compare dados demogr√°ficos e financeiros do Brasil</p>
  </div>

  <!-- Navega√ß√£o por Se√ß√µes -->
  <div class="secoes-navigation">
    <button 
      class="secao-button"
      [class.secao-active]="secaoAtiva === 'ibge'"
      (click)="selecionarSecao('ibge')">
      üìä Dados IBGE
    </button>
    <button 
      class="secao-button"
      [class.secao-active]="secaoAtiva === 'despesas'"
      (click)="selecionarSecao('despesas')">
      üí∞ Despesas P√∫blicas
    </button>
    <button 
      class="secao-button"
      [class.secao-active]="secaoAtiva === 'comparacao'"
      (click)="selecionarSecao('comparacao')">
      üìà Compara√ß√£o
    </button>
  </div>

  <!-- Conte√∫do das Se√ß√µes -->
  <div class="secoes-content">

    <!-- SE√á√ÉO IBGE -->
    <div class="secao-panel" *ngIf="secaoAtiva === 'ibge'">
      <div class="panel-section">
        <h3 class="section-title">An√°lise Demogr√°fica por Estado</h3>
        
        <div class="filter-section">
          <label class="filter-label">Selecione um Estado:</label>
          <select class="filter-select" [(ngModel)]="estadoSelecionado" (change)="carregarMunicipios()">
            <option *ngFor="let estado of estados" [value]="estado.sigla">
              {{ estado.nome }} ({{ estado.sigla }})
            </option>
          </select>
        </div>

        <!-- Aviso sobre a data dos dados -->
        <div class="data-info-box">
          <div class="info-icon-small">üìÖ</div>
          <div class="info-text-small">
            <strong>Dados de refer√™ncia:</strong> Popula√ß√£o total baseada em dados do IBGE 2024. 
            Top 5 munic√≠pios com dados populacionais estimados para 2023/2024.
          </div>
        </div>

        <div class="alert alert-error" *ngIf="erro">{{ erro }}</div>

        <div *ngIf="!loadingIbge && municipios.length > 0">
          <!-- Estat√≠sticas Resumidas -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üèôÔ∏è</div>
              <div class="stat-content">
                <div class="stat-label">Total de Munic√≠pios</div>
                <div class="stat-value">{{ formatarNumero(municipios.length) }}</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üë•</div>
              <div class="stat-content">
                <div class="stat-label">Popula√ß√£o Total</div>
                <div class="stat-value">{{ formatarNumero(totalPopulacao) }}</div>
              </div>
            </div>
          </div>

          <!-- Gr√°fico de Barras - Top 5 Munic√≠pios por Popula√ß√£o -->
          <div class="chart-section">
            <h4 class="chart-title">üèÜ Top 5 Munic√≠pios Mais Populosos</h4>
            <div class="bar-chart">
              <div class="bar-item" *ngFor="let dado of topMunicipiosPorPopulacao; let i = index">
                <div class="bar-label">
                  <span class="bar-position">{{ i + 1 }}¬∫</span>
                  <span class="bar-name">{{ dado.municipio }}</span>
                </div>
                <div class="bar-container">
                  <div 
                    class="bar-fill" 
                    [style.width]="getBarWidth(dado.populacao, topMunicipiosPorPopulacao[0].populacao)">
                  </div>
                </div>
                <div class="bar-value">{{ formatarNumero(dado.populacao) }}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="loading-container" *ngIf="loadingIbge">
          <div class="spinner"></div>
          <p>Carregando dados do IBGE...</p>
        </div>
      </div>
    </div>

    <!-- SE√á√ÉO DESPESAS -->
    <div class="secao-panel" *ngIf="secaoAtiva === 'despesas'">
      <div class="panel-section">
        <h3 class="section-title">An√°lise de Despesas Federais</h3>
        
        <!-- Aviso sobre a data dos dados -->
        <div class="data-info-box">
          <div class="info-icon-small">üìÖ</div>
          <div class="info-text-small">
            <strong>Dados de refer√™ncia:</strong> Valores baseados no Or√ßamento Federal 2024. 
            Dados aproximados para fins educacionais e demonstrativos.
          </div>
        </div>

        <button class="load-button" (click)="carregarDespesas()" [disabled]="loadingDespesas">
          {{ loadingDespesas ? 'Carregando...' : 'Carregar Dados de Despesas' }}
        </button>

        <div class="alert alert-error" *ngIf="erro">{{ erro }}</div>

        <div *ngIf="!loadingDespesas && despesas.length > 0">
          <!-- Total de Despesas -->
          <div class="total-section">
            <div class="total-card">
              <div class="total-icon">üíµ</div>
              <div class="total-content">
                <div class="total-label">Total de Despesas (2024)</div>
                <div class="total-value">{{ formatarMoeda(totalDespesas) }}</div>
              </div>
            </div>
          </div>

          <!-- Gr√°fico de Despesas por √ìrg√£o -->
          <div class="chart-section">
            <h4 class="chart-title">üèõÔ∏è Despesas por √ìrg√£o</h4>
            <div class="bar-chart">
              <div class="bar-item" *ngFor="let despesa of despesas.slice(0, 5)">
                <div class="bar-label">
                  <span class="bar-name">{{ despesa.orgao }}</span>
                </div>
                <div class="bar-container">
                  <div 
                    class="bar-fill bar-fill-green" 
                    [style.width]="getBarWidth(despesa.valor, despesas[0].valor)">
                  </div>
                </div>
                <div class="bar-value">{{ formatarMoeda(despesa.valor) }}</div>
              </div>
            </div>
          </div>

          <!-- Gr√°fico de Despesas por M√™s -->
          <div class="chart-section">
            <h4 class="chart-title">üìÖ Despesas por M√™s (2024)</h4>
            <div class="line-chart">
              <div class="line-item" *ngFor="let item of despesasPorMes">
                <div class="line-label">{{ item.mes }}</div>
                <div class="line-bar-container">
                  <div 
                    class="line-bar" 
                    [style.height]="getBarWidth(item.valor, maxDespesaPorMes)">
                  </div>
                </div>
                <div class="line-value">{{ formatarMoeda(item.valor) }}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="loading-container" *ngIf="loadingDespesas">
          <div class="spinner"></div>
          <p>Carregando dados de despesas...</p>
        </div>
      </div>
    </div>

    <!-- SE√á√ÉO COMPARA√á√ÉO -->
    <div class="secao-panel" *ngIf="secaoAtiva === 'comparacao'">
      <div class="panel-section">
        <h3 class="section-title">Compara√ß√£o entre Estados</h3>
        
        <!-- Aviso sobre a funcionalidade -->
        <div class="data-info-box">
          <div class="info-icon-small">üìä</div>
          <div class="info-text-small">
            <strong>Compare dados demogr√°ficos:</strong> Selecione at√© 3 estados diferentes e veja 
            uma compara√ß√£o lado a lado de popula√ß√£o, munic√≠pios e principais cidades.
          </div>
        </div>

        <!-- Seletor de Estados para Compara√ß√£o -->
        <div class="comparison-selector">
          <div class="selector-group">
            <label class="filter-label">Estado 1:</label>
            <select class="filter-select" [(ngModel)]="estadoComparacao1" (change)="atualizarComparacao()">
              <option value="">Selecione</option>
              <option *ngFor="let estado of estados" [value]="estado.sigla">
                {{ estado.nome }} ({{ estado.sigla }})
              </option>
            </select>
          </div>

          <div class="selector-group">
            <label class="filter-label">Estado 2:</label>
            <select class="filter-select" [(ngModel)]="estadoComparacao2" (change)="atualizarComparacao()">
              <option value="">Selecione</option>
              <option *ngFor="let estado of estados" [value]="estado.sigla">
                {{ estado.nome }} ({{ estado.sigla }})
              </option>
            </select>
          </div>

          <div class="selector-group">
            <label class="filter-label">Estado 3 (opcional):</label>
            <select class="filter-select" [(ngModel)]="estadoComparacao3" (change)="atualizarComparacao()">
              <option value="">Selecione</option>
              <option *ngFor="let estado of estados" [value]="estado.sigla">
                {{ estado.nome }} ({{ estado.sigla }})
              </option>
            </select>
          </div>
        </div>

        <!-- Tabela de Compara√ß√£o -->
        <div class="comparison-table-wrapper" *ngIf="estadoComparacao1 && estadoComparacao2">
          <h4 class="chart-title">üìã Comparativo de Popula√ß√£o e Munic√≠pios</h4>
          
          <div class="comparison-table">
            <!-- Cabe√ßalho -->
            <div class="table-header">
              <div class="table-cell header-cell">Indicador</div>
              <div class="table-cell header-cell">{{ getNomeEstado(estadoComparacao1) }}</div>
              <div class="table-cell header-cell">{{ getNomeEstado(estadoComparacao2) }}</div>
              <div class="table-cell header-cell" *ngIf="estadoComparacao3">{{ getNomeEstado(estadoComparacao3) }}</div>
            </div>

            <!-- Popula√ß√£o Total -->
            <div class="table-row">
              <div class="table-cell label-cell">üë• Popula√ß√£o Total</div>
              <div class="table-cell data-cell">{{ formatarNumero(getPopulacaoEstado(estadoComparacao1)) }}</div>
              <div class="table-cell data-cell">{{ formatarNumero(getPopulacaoEstado(estadoComparacao2)) }}</div>
              <div class="table-cell data-cell" *ngIf="estadoComparacao3">{{ formatarNumero(getPopulacaoEstado(estadoComparacao3)) }}</div>
            </div>

            <!-- Total de Munic√≠pios -->
            <div class="table-row">
              <div class="table-cell label-cell">üèôÔ∏è Total de Munic√≠pios</div>
              <div class="table-cell data-cell">{{ getMunicipiosEstado(estadoComparacao1) }}</div>
              <div class="table-cell data-cell">{{ getMunicipiosEstado(estadoComparacao2) }}</div>
              <div class="table-cell data-cell" *ngIf="estadoComparacao3">{{ getMunicipiosEstado(estadoComparacao3) }}</div>
            </div>

            <!-- Maior Cidade -->
            <div class="table-row">
              <div class="table-cell label-cell">üèÜ Maior Cidade</div>
              <div class="table-cell data-cell">{{ getMaiorCidade(estadoComparacao1) }}</div>
              <div class="table-cell data-cell">{{ getMaiorCidade(estadoComparacao2) }}</div>
              <div class="table-cell data-cell" *ngIf="estadoComparacao3">{{ getMaiorCidade(estadoComparacao3) }}</div>
            </div>

            <!-- Popula√ß√£o da Maior Cidade -->
            <div class="table-row">
              <div class="table-cell label-cell">üìä Pop. Maior Cidade</div>
              <div class="table-cell data-cell">{{ formatarNumero(getPopulacaoMaiorCidade(estadoComparacao1)) }}</div>
              <div class="table-cell data-cell">{{ formatarNumero(getPopulacaoMaiorCidade(estadoComparacao2)) }}</div>
              <div class="table-cell data-cell" *ngIf="estadoComparacao3">{{ formatarNumero(getPopulacaoMaiorCidade(estadoComparacao3)) }}</div>
            </div>

            <!-- Regi√£o -->
            <div class="table-row">
              <div class="table-cell label-cell">üó∫Ô∏è Regi√£o</div>
              <div class="table-cell data-cell">{{ getRegiaoEstado(estadoComparacao1) }}</div>
              <div class="table-cell data-cell">{{ getRegiaoEstado(estadoComparacao2) }}</div>
              <div class="table-cell data-cell" *ngIf="estadoComparacao3">{{ getRegiaoEstado(estadoComparacao3) }}</div>
            </div>

            <!-- √Årea Territorial -->
            <div class="table-row">
              <div class="table-cell label-cell">üìê √Årea Territorial</div>
              <div class="table-cell data-cell">{{ formatarNumero(getAreaEstado(estadoComparacao1)) }} km¬≤</div>
              <div class="table-cell data-cell">{{ formatarNumero(getAreaEstado(estadoComparacao2)) }} km¬≤</div>
              <div class="table-cell data-cell" *ngIf="estadoComparacao3">{{ formatarNumero(getAreaEstado(estadoComparacao3)) }} km¬≤</div>
            </div>

            <!-- Densidade Demogr√°fica -->
            <div class="table-row">
              <div class="table-cell label-cell">üî¢ Densidade Demogr√°fica</div>
              <div class="table-cell data-cell">{{ getDensidadeDemografica(estadoComparacao1).toFixed(2) }} hab/km¬≤</div>
              <div class="table-cell data-cell">{{ getDensidadeDemografica(estadoComparacao2).toFixed(2) }} hab/km¬≤</div>
              <div class="table-cell data-cell" *ngIf="estadoComparacao3">{{ getDensidadeDemografica(estadoComparacao3).toFixed(2) }} hab/km¬≤</div>
            </div>

            <!-- PIB Estadual -->
            <div class="table-row">
              <div class="table-cell label-cell">üí∞ PIB Estadual</div>
              <div class="table-cell data-cell">R$ {{ getPibEstado(estadoComparacao1).toFixed(1) }} bi</div>
              <div class="table-cell data-cell">R$ {{ getPibEstado(estadoComparacao2).toFixed(1) }} bi</div>
              <div class="table-cell data-cell" *ngIf="estadoComparacao3">R$ {{ getPibEstado(estadoComparacao3).toFixed(1) }} bi</div>
            </div>

            <!-- PIB Per Capita -->
            <div class="table-row">
              <div class="table-cell label-cell">üíµ PIB Per Capita</div>
              <div class="table-cell data-cell">{{ formatarMoeda(getPibPerCapita(estadoComparacao1)) }}</div>
              <div class="table-cell data-cell">{{ formatarMoeda(getPibPerCapita(estadoComparacao2)) }}</div>
              <div class="table-cell data-cell" *ngIf="estadoComparacao3">{{ formatarMoeda(getPibPerCapita(estadoComparacao3)) }}</div>
            </div>
          </div>

          <!-- Gr√°fico de Barras Comparativo -->
          <div class="chart-section comparison-chart">
            <h4 class="chart-title">üìä Compara√ß√£o Visual de Popula√ß√£o</h4>
            <div class="bar-chart-horizontal">
              <div class="bar-item-horizontal">
                <div class="bar-label-horizontal">{{ getNomeEstado(estadoComparacao1) }}</div>
                <div class="bar-container-horizontal">
                  <div 
                    class="bar-fill-horizontal bar-color-1" 
                    [style.width]="getBarWidthComparacao(estadoComparacao1)">
                  </div>
                </div>
                <div class="bar-value-horizontal">{{ formatarNumero(getPopulacaoEstado(estadoComparacao1)) }}</div>
              </div>

              <div class="bar-item-horizontal">
                <div class="bar-label-horizontal">{{ getNomeEstado(estadoComparacao2) }}</div>
                <div class="bar-container-horizontal">
                  <div 
                    class="bar-fill-horizontal bar-color-2" 
                    [style.width]="getBarWidthComparacao(estadoComparacao2)">
                  </div>
                </div>
                <div class="bar-value-horizontal">{{ formatarNumero(getPopulacaoEstado(estadoComparacao2)) }}</div>
              </div>

              <div class="bar-item-horizontal" *ngIf="estadoComparacao3">
                <div class="bar-label-horizontal">{{ getNomeEstado(estadoComparacao3) }}</div>
                <div class="bar-container-horizontal">
                  <div 
                    class="bar-fill-horizontal bar-color-3" 
                    [style.width]="getBarWidthComparacao(estadoComparacao3)">
                  </div>
                </div>
                <div class="bar-value-horizontal">{{ formatarNumero(getPopulacaoEstado(estadoComparacao3)) }}</div>
              </div>
            </div>
          </div>

          <!-- Gr√°fico de √Årea Territorial -->
          <div class="chart-section comparison-chart">
            <h4 class="chart-title">üìê Compara√ß√£o de √Årea Territorial</h4>
            <div class="bar-chart-horizontal">
              <div class="bar-item-horizontal">
                <div class="bar-label-horizontal">{{ getNomeEstado(estadoComparacao1) }}</div>
                <div class="bar-container-horizontal">
                  <div 
                    class="bar-fill-horizontal bar-color-1" 
                    [style.width]="getBarWidthArea(estadoComparacao1)">
                  </div>
                </div>
                <div class="bar-value-horizontal">{{ formatarNumero(getAreaEstado(estadoComparacao1)) }} km¬≤</div>
              </div>

              <div class="bar-item-horizontal">
                <div class="bar-label-horizontal">{{ getNomeEstado(estadoComparacao2) }}</div>
                <div class="bar-container-horizontal">
                  <div 
                    class="bar-fill-horizontal bar-color-2" 
                    [style.width]="getBarWidthArea(estadoComparacao2)">
                  </div>
                </div>
                <div class="bar-value-horizontal">{{ formatarNumero(getAreaEstado(estadoComparacao2)) }} km¬≤</div>
              </div>

              <div class="bar-item-horizontal" *ngIf="estadoComparacao3">
                <div class="bar-label-horizontal">{{ getNomeEstado(estadoComparacao3) }}</div>
                <div class="bar-container-horizontal">
                  <div 
                    class="bar-fill-horizontal bar-color-3" 
                    [style.width]="getBarWidthArea(estadoComparacao3)">
                  </div>
                </div>
                <div class="bar-value-horizontal">{{ formatarNumero(getAreaEstado(estadoComparacao3)) }} km¬≤</div>
              </div>
            </div>
          </div>

          <!-- Gr√°fico de PIB -->
          <div class="chart-section comparison-chart">
            <h4 class="chart-title">üí∞ Compara√ß√£o de PIB Estadual</h4>
            <div class="bar-chart-horizontal">
              <div class="bar-item-horizontal">
                <div class="bar-label-horizontal">{{ getNomeEstado(estadoComparacao1) }}</div>
                <div class="bar-container-horizontal">
                  <div 
                    class="bar-fill-horizontal bar-color-1" 
                    [style.width]="getBarWidthPib(estadoComparacao1)">
                  </div>
                </div>
                <div class="bar-value-horizontal">R$ {{ getPibEstado(estadoComparacao1).toFixed(1) }} bi</div>
              </div>

              <div class="bar-item-horizontal">
                <div class="bar-label-horizontal">{{ getNomeEstado(estadoComparacao2) }}</div>
                <div class="bar-container-horizontal">
                  <div 
                    class="bar-fill-horizontal bar-color-2" 
                    [style.width]="getBarWidthPib(estadoComparacao2)">
                  </div>
                </div>
                <div class="bar-value-horizontal">R$ {{ getPibEstado(estadoComparacao2).toFixed(1) }} bi</div>
              </div>

              <div class="bar-item-horizontal" *ngIf="estadoComparacao3">
                <div class="bar-label-horizontal">{{ getNomeEstado(estadoComparacao3) }}</div>
                <div class="bar-container-horizontal">
                  <div 
                    class="bar-fill-horizontal bar-color-3" 
                    [style.width]="getBarWidthPib(estadoComparacao3)">
                  </div>
                </div>
                <div class="bar-value-horizontal">R$ {{ getPibEstado(estadoComparacao3).toFixed(1) }} bi</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Mensagem quando nenhum estado selecionado -->
        <div class="empty-state" *ngIf="!estadoComparacao1 || !estadoComparacao2">
          <div class="empty-icon">üìä</div>
          <h4 class="empty-title">Selecione estados para comparar</h4>
          <p class="empty-text">
            Escolha pelo menos 2 estados nos seletores acima para visualizar uma compara√ß√£o 
            detalhada de dados demogr√°ficos.
          </p>
        </div>

        <!-- Informa√ß√µes Adicionais -->
        <div class="info-section">
          <h4 class="info-title">‚ÑπÔ∏è Sobre as Compara√ß√µes</h4>
          <div class="info-content">
            <p><strong>Dados Utilizados:</strong></p>
            <ul class="info-list">
              <li><strong>Popula√ß√£o Total:</strong> Estimativa IBGE 2024 para cada estado</li>
              <li><strong>Total de Munic√≠pios:</strong> Quantidade de cidades em cada estado (IBGE)</li>
              <li><strong>Maior Cidade:</strong> Munic√≠pio mais populoso de cada estado</li>
              <li><strong>Regi√£o:</strong> Regi√£o geogr√°fica do Brasil (Norte, Nordeste, Centro-Oeste, Sudeste, Sul)</li>
              <li><strong>√Årea Territorial:</strong> Extens√£o territorial oficial em km¬≤ (IBGE)</li>
              <li><strong>Densidade Demogr√°fica:</strong> Habitantes por km¬≤ (popula√ß√£o √∑ √°rea)</li>
              <li><strong>PIB Estadual:</strong> Produto Interno Bruto estimado para 2024 em bilh√µes de R$</li>
              <li><strong>PIB Per Capita:</strong> PIB dividido pela popula√ß√£o (em reais por habitante)</li>
            </ul>
            
            <p><strong>Como Usar:</strong></p>
            <ul class="info-list">
              <li>Selecione 2 ou 3 estados para compara√ß√£o lado a lado</li>
              <li>Visualize dados demogr√°ficos, geogr√°ficos e econ√¥micos na tabela</li>
              <li>Analise os gr√°ficos de barras para compara√ß√£o visual</li>
              <li>Compare popula√ß√£o, √°rea territorial e PIB entre estados</li>
              <li>Troque os estados quantas vezes quiser para diferentes an√°lises</li>
            </ul>

            <p><strong>Insights Interessantes:</strong></p>
            <ul class="info-list">
              <li>Compare <strong>Distrito Federal</strong> (menor √°rea) com <strong>Amazonas</strong> (maior √°rea)</li>
              <li>Veja a diferen√ßa de densidade entre <strong>Rio de Janeiro</strong> (alta) e <strong>Roraima</strong> (baixa)</li>
              <li>Analise o PIB de <strong>S√£o Paulo</strong> versus outros estados</li>
              <li>Compare estados da mesma regi√£o ou de regi√µes diferentes</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
